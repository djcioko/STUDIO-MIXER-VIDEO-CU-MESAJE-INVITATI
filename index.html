<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MV STUDIO PRO - ULTIMATE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --main: #ffaa00; --msg-size: 28px; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; }
        
        /* ECRANUL PRINCIPAL (Ocupă tot) */
        #viewport { position: relative; width: 100vw; height: 100vh; background: #000; z-index: 1; }

        /* STRATURI FUNDAL */
        #bg-v, #bg-i, #bg-s { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; display: none; z-index: 1; }
        #overlay { position: absolute; inset: 0; background: var(--main); mix-blend-mode: overlay; opacity: 0.3; z-index: 2; pointer-events: none; }

        /* ELEMENTE MOBILE */
        #cam-box { position: absolute; z-index: 10; cursor: move; border: 2px solid rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
        #v-src { width: 100%; height: 100%; object-fit: cover; }
        #circle-box { position: absolute; z-index: 20; cursor: move; }
        #branding { position: absolute; z-index: 25; cursor: move; color: white; font-weight: 900; text-shadow: 3px 3px 10px #000; white-space: nowrap; }

        /* MESAJUL (STRAT SUPREM) */
        #msg-box {
            position: absolute; z-index: 9999; 
            background: rgba(0, 0, 0, 0.9); border-left: 8px solid var(--main);
            padding: 20px; border-radius: 0 15px 15px 0;
            min-width: 300px; max-width: 600px; cursor: move;
            display: none; box-shadow: 0 0 40px #000;
        }
        #msg-user { color: var(--main); font-weight: bold; font-size: 20px; display: block; text-transform: uppercase; }
        #msg-txt { color: white; font-size: var(--msg-size); font-style: italic; }

        /* CONSOLA PLUTITOARE (PENTRU CONTROL) */
        #console {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 10000; background: rgba(20, 20, 20, 0.95);
            padding: 15px; border-radius: 15px; border: 2px solid var(--main);
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 10px;
            width: 95%; max-width: 1200px; backdrop-filter: blur(10px);
        }
        .cube { background: #111; padding: 8px; border-radius: 8px; display: flex; flex-direction: column; gap: 5px; border: 1px solid #333; }
        h4 { color: var(--main); font-size: 10px; font-weight: bold; text-align: center; border-bottom: 1px solid #333; }
        button { background: #333; color: white; font-size: 10px; padding: 5px; border-radius: 4px; font-weight: bold; }
        button:hover { background: var(--main); color: #000; }
        input { background: #000; color: white; font-size: 9px; border: 1px solid #444; }
        .fs-btn { background: #e63946 !important; }
    </style>
</head>
<body>

    <div id="viewport">
        <video id="bg-v" autoplay loop muted></video>
        <img id="bg-i">
        <img id="bg-s">
        <div id="overlay"></div>

        <div id="cam-box" style="top:20px; right:20px; width:280px; height:200px;">
            <video id="v-src" autoplay playsinline></video>
        </div>

        <div id="circle-box" style="top:50%; left:50%; width:250px; height:250px; transform: translate(-50%, -50%);">
            <canvas id="radial-canvas" width="500" height="500" style="position:absolute;"></canvas>
            <div id="inner-circle" style="width:150px; height:150px; border-radius:50%; border:4px solid var(--main); margin:50px auto; overflow:hidden; background:#000;">
                <img id="inner-img" style="width:100%; height:100%; object-fit:cover; display:none;">
            </div>
        </div>

        <div id="branding" style="bottom:150px; left:50px; font-size:40px;">STUDIO MV PRO</div>

        <div id="msg-box" style="top:100px; left:50px;">
            <span id="msg-user">INVITAT</span>
            <span id="msg-txt">Mesaj...</span>
        </div>

        <div id="console">
            <div class="cube"><h4>1. VIDEO</h4><input type="file" onchange="loadV(this)"><button onclick="tg('bg-v')">VIDEO ON</button><button onclick="goFS()" class="fs-btn">FULL SCREEN</button></div>
            <div class="cube"><h4>2. FOTO</h4><input type="file" onchange="loadI(this)"><button onclick="tg('bg-i')">FOTO ON</button></div>
            <div class="cube"><h4>3. SLIDE</h4><input type="file" multiple onchange="loadS(this)"><button onclick="tg('bg-s')">SLIDE ON</button><span>Sec:</span><input type="range" min="1" max="10" value="3" id="s-dur"></div>
            <div class="cube"><h4>4. CAMERA</h4><button onclick="initCam()" style="color:var(--main)">START CAM</button><span>Opac:</span><input type="range" min="0" max="1" step="0.1" value="1" oninput="document.getElementById('cam-box').style.opacity=this.value"></div>
            <div class="cube"><h4>5. BRANDING</h4><input type="text" placeholder="Text..." oninput="document.getElementById('branding').innerText=this.value"><span>Mărime:</span><input type="range" min="20" max="100" value="40" oninput="document.getElementById('branding').style.fontSize=this.value+'px'"></div>
            <div class="cube"><h4>6. MESAJE</h4><input type="text" id="ev-id" value="test_dj" onchange="updateDb(this.value)"><span>Timp:</span><input type="range" min="3" max="30" value="10" id="msg-dur"><span>TXT SIZE:</span><input type="range" min="18" max="70" value="28" oninput="document.documentElement.style.setProperty('--msg-size', this.value+'px')"></div>
        </div>
    </div>

<script>
    firebase.initializeApp({ databaseURL: "https://felicitari-nunta-default-rtdb.firebaseio.com" });
    let db = firebase.database().ref('test_dj');
    let mTimer, sTimer, sFiles = [], sIdx = 0;

    function updateDb(id) { db.off(); db = firebase.database().ref(id); listen(); }
    function listen() {
        db.limitToLast(1).on('child_added', (sn) => {
            const d = sn.val();
            const b = document.getElementById('msg-box');
            document.getElementById('msg-user').innerText = d.author;
            document.getElementById('msg-txt').innerText = `"${d.text}"`;
            b.style.display = 'block';
            if(mTimer) clearTimeout(mTimer);
            mTimer = setTimeout(() => { b.style.display = 'none'; }, document.getElementById('msg-dur').value * 1000);
        });
    }

    function goFS() { let v = document.getElementById('viewport'); if(v.requestFullscreen) v.requestFullscreen(); else if(v.webkitRequestFullscreen) v.webkitRequestFullscreen(); }

    function loadV(i){ document.getElementById('bg-v').src=URL.createObjectURL(i.files[0]); tg('bg-v'); }
    function loadI(i){ document.getElementById('bg-i').src=URL.createObjectURL(i.files[0]); tg('bg-i'); }
    function loadS(i){ sFiles = Array.from(i.files).map(f => URL.createObjectURL(f)); }
    function runSlide() {
        if(sFiles.length === 0) return;
        document.getElementById('bg-s').src = sFiles[sIdx];
        sIdx = (sIdx + 1) % sFiles.length;
        sTimer = setTimeout(runSlide, document.getElementById('s-dur').value * 1000);
    }
    function tg(id){ ['bg-v','bg-i','bg-s'].forEach(e => document.getElementById(e).style.display='none'); document.getElementById(id).style.display='block'; if(id==='bg-s'){if(sTimer)clearTimeout(sTimer); runSlide();} }

    function initCam() {
        navigator.mediaDevices.getUserMedia({video: true, audio: true}).then(s => {
            document.getElementById('v-src').srcObject = s;
            const ctx = new AudioContext(), src = ctx.createMediaStreamSource(s), ans = ctx.createAnalyser();
            ans.fftSize = 256; src.connect(ans);
            const data = new Uint8Array(ans.frequencyBinCount);
            function draw() {
                requestAnimationFrame(draw); ans.getByteFrequencyData(data);
                const can = document.getElementById('radial-canvas'), c = can.getContext('2d');
                c.clearRect(0,0,500,500);
                let sum = 0; for(let i=0; i<20; i++) sum += data[i];
                document.getElementById('circle-box').style.transform = `translate(-50%, -50%) scale(${1 + (sum/20/255)*0.4})`;
                c.strokeStyle = '#ffaa00'; c.lineWidth = 4;
                for(let i=0; i<60; i++){
                    let a = (i*6)*Math.PI/180, l = data[i] * 0.5;
                    c.beginPath(); c.moveTo(250+Math.cos(a)*100, 250+Math.sin(a)*100);
                    c.lineTo(250+Math.cos(a)*(100+l), 250+Math.sin(a)*(100+l)); c.stroke();
                }
            } draw(); listen();
        });
    }

    function drag(e) {
        let p1=0, p2=0, p3=0, p4=0;
        e.onmousedown = (m) => {
            if(m.target.tagName === 'INPUT' || m.target.tagName === 'BUTTON') return;
            m.preventDefault(); p3=m.clientX; p4=m.clientY;
            document.onmouseup = () => { document.onmouseup=null; document.onmousemove=null; };
            document.onmousemove = (m) => {
                p1=p3-m.clientX; p2=p4-m.clientY; p3=m.clientX; p4=m.clientY;
                e.style.top=(e.offsetTop-p2)+"px"; e.style.left=(e.offsetLeft-p1)+"px";
            };
        };
    }
    [document.getElementById('msg-box'), document.getElementById('circle-box'), document.getElementById('cam-box'), document.getElementById('branding'), document.getElementById('console')].forEach(drag);
</script>
</body>
</html>
