
<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MV STUDIO PRO - CLEAN & STABLE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --main: #ffaa00; --msg-size: 26px; }
        body, html { margin: 0; padding: 0; width: 100vw; height: 100vh; background: #000; overflow: hidden; font-family: sans-serif; }
        
        #viewport { position: relative; width: 100%; height: 100%; overflow: hidden; background: #000; }

        /* FUNDALURI (FARA OVERLAY COLOR) */
        #bg-v, #bg-i, #bg-s { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; display: none; z-index: 1; }

        /* CAMERA AI CUT (CERC PERFECT) */
        #cam-box { 
            position: absolute; z-index: 10; cursor: move; 
            width: 180px; height: 180px; border-radius: 50%; 
            border: 3px solid var(--main); overflow: hidden;
        }
        #v-src { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }

        /* VUMETRU */
        #circle-box { position: absolute; z-index: 15; cursor: move; width: 220px; height: 220px; display: flex; align-items: center; justify-content: center; }
        #radial-canvas { position: absolute; pointer-events: none; }
        #inner-circle { width: 130px; height: 130px; border-radius: 50%; border: 3px solid var(--main); background: #000; overflow: hidden; }

        /* TEXT STUDIO */
        #branding { position: absolute; z-index: 20; cursor: move; color: white; font-weight: 900; text-shadow: 2px 2px 10px #000; }

        /* MESAJE FIREBASE (STRAT SUPREM) */
        #msg-box {
            position: absolute; z-index: 9999 !important; 
            background: rgba(0, 0, 0, 0.9); border-left: 8px solid var(--main);
            padding: 20px; border-radius: 0 15px 15px 0;
            min-width: 300px; max-width: 550px; cursor: move; display: none;
        }
        #msg-user { color: var(--main); font-weight: bold; font-size: 18px; text-transform: uppercase; }
        #msg-txt { color: white; font-size: var(--msg-size); font-style: italic; }

        /* CONSOLA DJ MINI */
        #gui {
            position: absolute; bottom: 0; left: 0; right: 0;
            z-index: 10000; background: rgba(10, 10, 10, 0.9);
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; padding: 4px;
        }
        .cube { background: #1a1a1a; padding: 4px; border-radius: 3px; display: flex; flex-direction: column; gap: 2px; border: 1px solid #222; }
        h4 { color: var(--main); font-size: 8px; text-align: center; font-weight: bold; }
        button { background: #333; color: white; font-size: 8px; padding: 3px; border-radius: 2px; }
        button:hover { background: var(--main); color: #000; }
        .btn-off { background: #551111 !important; }
        .btn-fs { background: #ff4400 !important; color: white !important; }
        input { background: #000; color: white; font-size: 8px; width: 100%; }
        input[type="range"] { accent-color: var(--main); }
    </style>
</head>
<body>

    <div id="viewport">
        <video id="bg-v" autoplay loop muted></video>
        <img id="bg-i">
        <img id="bg-s">

        <div id="cam-box" style="top:20px; right:20px;">
            <video id="v-src" autoplay playsinline></video>
        </div>

        <div id="circle-box" style="top:30%; left:40%;">
            <canvas id="radial-canvas" width="400" height="400"></canvas>
            <div id="inner-circle">
                <img id="inner-img" style="width:100%; height:100%; object-fit:cover; display:none;">
            </div>
        </div>

        <div id="branding" style="bottom:100px; left:40px; font-size:35px;">STUDIO MV PRO</div>

        <div id="msg-box" style="top:80px; left:40px;">
            <span id="msg-user">INVITAT</span><br>
            <span id="msg-txt">Mesajul live...</span>
        </div>

        <div id="gui">
            <div class="cube"><h4>VIDEO</h4><input type="file" onchange="loadV(this)"><button onclick="toggleBG('bg-v')">ON/OFF</button></div>
            <div class="cube"><h4>FOTO</h4><input type="file" onchange="loadI(this)"><button onclick="toggleBG('bg-i')">ON/OFF</button></div>
            <div class="cube"><h4>SLIDE</h4><input type="file" multiple onchange="loadS(this)"><button onclick="toggleBG('bg-s')">ON/OFF</button></div>
            <div class="cube"><h4>CAM</h4><button onclick="initCam()">START</button><input type="range" min="0" max="1" step="0.1" value="1" oninput="document.getElementById('cam-box').style.opacity=this.value"></div>
            <div class="cube"><h4>TEXT</h4><input type="text" oninput="document.getElementById('branding').innerText=this.value"><input type="range" min="20" max="100" value="35" oninput="document.getElementById('branding').style.fontSize=this.value+'px'"></div>
            <div class="cube"><h4>MSG</h4><input type="text" id="ev-id" value="test_dj" onchange="updateDb(this.value)"><input type="range" min="15" max="60" value="26" oninput="document.documentElement.style.setProperty('--msg-size', this.value+'px')"></div>
            <div class="cube"><h4>SCREEN</h4><button class="btn-fs" onclick="goFS()">FULL SCREEN</button><button class="btn-off" onclick="location.reload()">RESET</button></div>
        </div>
    </div>

<script>
    firebase.initializeApp({ databaseURL: "https://felicitari-nunta-default-rtdb.firebaseio.com" });
    let db = firebase.database().ref('test_dj');
    let mTimer, sTimer, sFiles = [], sIdx = 0;

    function goFS() {
        let v = document.getElementById('viewport');
        if (v.requestFullscreen) v.requestFullscreen();
        else if (v.webkitRequestFullscreen) v.webkitRequestFullscreen();
    }

    function updateDb(id) { db.off(); db = firebase.database().ref(id); listen(); }
    function listen() {
        db.limitToLast(1).on('child_added', (sn) => {
            const d = sn.val();
            const box = document.getElementById('msg-box');
            document.getElementById('msg-user').innerText = d.author;
            document.getElementById('msg-txt').innerText = `"${d.text}"`;
            box.style.display = 'block';
            if(mTimer) clearTimeout(mTimer);
            mTimer = setTimeout(() => { box.style.display = 'none'; }, 10000);
        });
    }

    function toggleBG(id) {
        let el = document.getElementById(id);
        let isVisible = el.style.display === 'block';
        document.getElementById('bg-v').style.display = 'none';
        document.getElementById('bg-i').style.display = 'none';
        document.getElementById('bg-s').style.display = 'none';
        if(sTimer) clearTimeout(sTimer);
        
        if (!isVisible) {
            el.style.display = 'block';
            if(id === 'bg-s') runSlide();
        }
    }

    function loadV(i){ document.getElementById('bg-v').src=URL.createObjectURL(i.files[0]); }
    function loadI(i){ document.getElementById('bg-i').src=URL.createObjectURL(i.files[0]); }
    function loadS(i){ sFiles = Array.from(i.files).map(f => URL.createObjectURL(f)); }
    
    function runSlide() {
        if(!sFiles.length) return;
        document.getElementById('bg-s').src = sFiles[sIdx];
        sIdx = (sIdx + 1) % sFiles.length;
        sTimer = setTimeout(runSlide, 4000);
    }

    function initCam() {
        navigator.mediaDevices.getUserMedia({video: true, audio: true}).then(s => {
            document.getElementById('v-src').srcObject = s;
            const ctx = new AudioContext(), src = ctx.createMediaStreamSource(s), ans = ctx.createAnalyser();
            ans.fftSize = 256; src.connect(ans);
            const data = new Uint8Array(ans.frequencyBinCount);
            function draw() {
                requestAnimationFrame(draw); ans.getByteFrequencyData(data);
                const can = document.getElementById('radial-canvas'), c = can.getContext('2d');
                c.clearRect(0,0,400,400);
                let sum = 0; for(let i=0; i<20; i++) sum += data[i];
                document.getElementById('circle-box').style.transform = `scale(${1 + (sum/20/255)*0.3})`;
                c.strokeStyle = '#ffaa00'; c.lineWidth = 4;
                for(let i=0; i<60; i++){
                    let a = (i*6)*Math.PI/180, l = data[i] * 0.4;
                    c.beginPath(); c.moveTo(200+Math.cos(a)*80, 200+Math.sin(a)*80);
                    c.lineTo(200+Math.cos(a)*(80+l), 200+Math.sin(a)*(80+l)); c.stroke();
                }
            } draw(); listen();
        });
    }

    function drag(e) {
        let p1=0, p2=0, p3=0, p4=0;
        e.onmousedown = (m) => {
            if(m.target.tagName === 'INPUT' || m.target.tagName === 'BUTTON') return;
            p3=m.clientX; p4=m.clientY;
            document.onmouseup = () => { document.onmouseup=null; document.onmousemove=null; };
            document.onmousemove = (m) => {
                p1=p3-m.clientX; p2=p4-m.clientY; p3=m.clientX; p4=m.clientY;
                e.style.top=(e.offsetTop-p2)+"px"; e.style.left=(e.offsetLeft-p1)+"px";
            };
        };
    }
    [document.getElementById('msg-box'), document.getElementById('circle-box'), document.getElementById('cam-box'), document.getElementById('branding')].forEach(drag);
</script>
</body>
</html>
